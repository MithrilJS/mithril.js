(function(){function d(){function a(){0<arguments.length&&arguments[0]!==g&&h(a,arguments[0]);return a._state.value}r(a);0<arguments.length&&arguments[0]!==g&&h(a,arguments[0]);return a}function r(a){a.constructor=d;a._state={id:t++,value:void 0,state:0,derive:void 0,recover:void 0,deps:{},parents:[],endStream:void 0,unregister:void 0};a.map=a["fantasy-land/map"]=u;a["fantasy-land/ap"]=v;a["fantasy-land/of"]=d;a.valueOf=k;a.toJSON=w;a.toString=k;Object.defineProperties(a,{end:{get:function(){if(!a._state.endStream){var b=
d();b.map(function(c){!0===c&&(l(a),b._state.unregister=function(){l(b)});return c});a._state.endStream=b}return a._state.endStream}}})}function h(a,b){m(a,b);for(var c in a._state.deps)n(a._state.deps[c],!1);null!=a._state.unregister&&a._state.unregister();a._state.changed=!1;for(var e in a._state.deps)a._state.deps[e]._state.changed=!1}function m(a,b){a._state.value=b;a._state.changed=!0;2!==a._state.state&&(a._state.state=1)}function n(a,b){var c=a._state.parents;if(0<c.length&&c.every(x)&&(b||
c.some(p))){c=a._state.derive();if(c===g)return!1;m(a,c)}}function f(a,b){if(!b.every(y))throw Error("Ensure that each item passed to stream.combine/stream.merge is a stream");return z(d(),b,function(){return a.apply(this,b.concat([b.filter(p)]))})}function z(a,b,c){var e=a._state;e.derive=c;e.parents=b.filter(A);q(a,e.parents);n(a,!0);return a}function q(a,b){for(var c=0;c<b.length;c++)b[c]._state.deps[a._state.id]=a,q(a,b[c]._state.parents)}function l(a){for(var b=0;b<a._state.parents.length;b++)delete a._state.parents[b]._state.deps[a._state.id];
for(var c in a._state.deps){var b=a._state.deps[c],e=b._state.parents.indexOf(a);-1<e&&b._state.parents.splice(e,1)}a._state.state=2;a._state.deps={}}function u(a){return f(function(b){return a(b())},[this])}function v(a){return f(function(a,c){return a()(c())},[a,this])}function k(){return this._state.value}function w(){return null!=this._state.value&&"function"===typeof this._state.value.toJSON?this._state.value.toJSON():this._state.value}function y(a){return a._state}function x(a){return 1===a._state.state}
function p(a){return a._state.changed}function A(a){return 2!==a._state.state}var t=0,g={};d["fantasy-land/of"]=d;d.merge=function(a){return f(function(){return a.map(function(a){return a()})},a)};d.combine=f;d.scan=function(a,b,c){c=f(function(c){return b=a(b,c._state.value)},[c]);0===c._state.state&&c(b);return c};d.scanMerge=function(a,b){var c=a.map(function(a){a=a[0];0===a._state.state&&a(void 0);return a});return f(function(){var d=arguments[arguments.length-1];c.forEach(function(c,e){-1<d.indexOf(c)&&
(b=a[e][1](b,c._state.value))});return b},c)};d.HALT=g;"undefined"!==typeof module?module.exports=d:"function"!==typeof window.m||"stream"in window.m?window.m={stream:d}:window.m.stream=d})();